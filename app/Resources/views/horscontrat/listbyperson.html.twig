{% extends 'base.html.twig' %}

{% block body %}
{% set nbcol = 2 %}
<h1>Commandes hors contrat par adhérent</h1>
  <table class="table table-bordered" >
  <thead>
	<tr>
		<th align="center", colspan="{{ nbcol }}">Liste des commandes hors contrat par adhérent</th>'
	</tr>
   </thead>
   <tbody>
	{% set i = 0 %}
	{% set totalMeunier = 0 %}
	{% set totalReduc = 0 %}
	{% for nompersonne, personne in personnes %}
			{% if i == 0 %}
				 <tr>
			{% endif %}
		<td>
		<table class="table table-bordered" >
			<thead>
				<tr>
		{% set total = 0.0 %}
					<th colspan="3">{{ nompersonne }} </th>
				</tr>
			</thead>
			<tbody>
				{% for hc in personne['horscontrats'] %}
					{% set cout = hc.produit.prix * hc.nombre %}
				    {% set total = total + cout %}
					<tr>
					<td> {{ hc.produit.nomProduit }} 
						{% if hc.produit.t %}
							T {{hc.produit.t}}
						{% endif %}
						{% if hc.produit.bio %}
							bio 
						{% else %}
							non bio
						{% endif %}	
						{{ hc.produit.poid }} kg
					</td>
					<td align="right"> {{ hc.nombre }} </td>
					<td align="right"> {{ cout}} </td>
				</tr>
				{% endfor %}
				{% set totalReduc = (total *  0.93)|round(2) %}
<!--				<tr>
					<td colspan="2">Total</td>
					<td align="right"> {{ total }}</td>
				</tr>
-->
				<tr>
					<td colspan="2">Total tarif AMAP</td>
					<td align="right">  {{ totalReduc }}
					</td>
				</tr>
			</tbody>
		</table>
		</td>

		{% set i = i + 1 %}
		{% set totalMeunier = totalMeunier + totalReduc %}

		{% if i == nbcol %}
			</tr>
			{% set i = 0 %}
		{% endif %}

		{% endfor %} 
	{% if i != 0 %}
	</tr>
	{% endif %}
		<tr>
		<td align="center">
			<table class="table table-bordered">
				<thead>
					<tr>
						<th>Total du</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td> {{ totalMeunier }}
						</td>
					</tr>
				</tbody>
			</table>
		</td>
		</tr>
	</tbody>
</table>

{% endblock %} {# body #}
